<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diagnostics • JWileymisc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Diagnostics">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">JWileymisc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/diagnostics-vignette.html">Diagnostics</a>
    </li>
    <li>
      <a href="../articles/exploratory-vignette.html">Exploratory and Descriptive Statistics and Plots</a>
    </li>
    <li>
      <a href="../articles/model-test-vignette.html">Model Performance and Tests</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JWiley/JWileymisc">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Diagnostics</h1>
                        <h4 class="author">Joshua F. Wiley</h4>
            
            <h4 class="date">2019-12-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JWiley/JWileymisc/blob/master/R/vignettes/diagnostics-vignette.Rmd"><code>R/vignettes/diagnostics-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>diagnostics-vignette.Rmd</code></div>

    </div>

    
    
<p>To start, load the package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(JWileymisc)</span></code></pre></div>
<div id="univariate-diagnostics" class="section level1">
<h1 class="hasAnchor">
<a href="#univariate-diagnostics" class="anchor"></a>Univariate Diagnostics</h1>
<p>The <code><a href="../reference/testDistribution.html">testDistribution()</a></code> function can be used to evaluate whether a variable comes from a specific, known parametric distribution. By default, no outliers or “extreme values” are shown. These can be used directly through the data output or plotted. The plot includes both the empirical density, the density of the assumed parametric distribution, a rug plot showing actual values, if not too many data points, and a Quantile-Quantile plot (QQ Plot). The QQ Plot is rotated to save space, by removing the diagonal and rotating to be horizontal, which we call a QQ Deviates plot.</p>
<p>One other unique feature of the density plot is the x axis. It follows Tufte’s principles about presenting data. To make the x axis more informative, it is a “range frame”, meaning it is only plotted over the range of the actual data. Secondly, the breaks are a five number summary of the data. These five numbers are:</p>
<ul>
<li>Minimum (0th percentile)</li>
<li>Lower quartile (25th percentile)</li>
<li>Median (50th percentile)</li>
<li>Upper quartile (75th percentile)</li>
<li>Maximum (100th percentile)</li>
</ul>
<p>Most plots use breaks that are evenly spaced. These do not convey information about the data. Using a five number summary the breaks themselves are effectively like a boxplot with specific values provided so you can immediately read what values the min and max are, the median, etc.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a></span>
<span id="cb2-2"><a href="#cb2-2"></a>test &lt;-<span class="st"> </span><span class="kw"><a href="../reference/testDistribution.html">testDistribution</a></span>(mtcars<span class="op">$</span>mpg, <span class="st">"normal"</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(test<span class="op">$</span>Data)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt;            X    Y OriginalOrder isEV YDeviates</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; 1:  7.313777 10.4            15   No 3.0862233</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; 2: 10.148901 10.4            16   No 0.2510990</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; 3: 11.680210 13.3            24   No 1.6197895</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; 4: 12.795066 14.3             7   No 1.5049335</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; 5: 13.698771 14.7            17   No 1.0012292</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; 6: 14.474288 15.0            31   No 0.5257124</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(test<span class="op">$</span>Data<span class="op">$</span>isEV)</span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt;  No Yes </span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt;  32   0</span></span>
<span id="cb2-15"><a href="#cb2-15"></a></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(test)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>It is possible to have extreme values automatically identified either based on a theoretical distribution or empirically identified (e.g., the top or bottom XX percent are classified as extreme). We say that .10 (10%) of data points are “extreme” just to illustrate. Extreme values are shown in black with non extreme values shown in light grey, both in the rug plot and in the QQ plot. Although 10% is higher than typically would be chosen, given the small dataset, it is necessary to have extreme values at both ends of the distribution for illustration.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>test &lt;-<span class="st"> </span><span class="kw"><a href="../reference/testDistribution.html">testDistribution</a></span>(mtcars<span class="op">$</span>mpg, <span class="st">"normal"</span>,</span>
<span id="cb3-2"><a href="#cb3-2"></a>                         <span class="dt">extremevalues =</span> <span class="st">"theoretical"</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>                         <span class="dt">ev.perc =</span> <span class="fl">.10</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">## view the data with extreme values</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(test<span class="op">$</span>Data)</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt;            X    Y OriginalOrder isEV YDeviates</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; 1:  7.313777 10.4            15  Yes 3.0862233</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; 2: 10.148901 10.4            16  Yes 0.2510990</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; 3: 11.680210 13.3            24   No 1.6197895</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; 4: 12.795066 14.3             7   No 1.5049335</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; 5: 13.698771 14.7            17   No 1.0012292</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; 6: 14.474288 15.0            31   No 0.5257124</span></span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">## count how many extreme values there are</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(test<span class="op">$</span>Data<span class="op">$</span>isEV)</span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; </span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt;  No Yes </span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt;  26   6</span></span>
<span id="cb3-19"><a href="#cb3-19"></a></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">## plot the distribution</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(test)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">## show which values are extreme</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>test<span class="op">$</span>Data[isEV <span class="op">==</span><span class="st"> "Yes"</span>]</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;            X    Y OriginalOrder isEV YDeviates</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; 1:  7.313777 10.4            15  Yes  3.086223</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; 2: 10.148901 10.4            16  Yes  0.251099</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; 3: 27.386184 30.4            19  Yes  3.013816</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; 4: 28.501040 30.4            28  Yes  1.898960</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; 5: 30.032349 32.4            18  Yes  2.367651</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; 6: 32.867473 33.9            20  Yes  1.032527</span></span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">## view extreme values on mpg in the original dataset</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">## by use the original order, the original rows to select</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">## the correct rows from the original dataset</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>mtcars[test<span class="op">$</span>Data[isEV <span class="op">==</span><span class="st"> "Yes"</span>, OriginalOrder], ]</span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2</span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1</span></span></code></pre></div>
<p>Extreme values taken off the empirical percentiles can be chosen as well.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>test &lt;-<span class="st"> </span><span class="kw"><a href="../reference/testDistribution.html">testDistribution</a></span>(mtcars<span class="op">$</span>mpg, <span class="st">"normal"</span>,</span>
<span id="cb5-2"><a href="#cb5-2"></a>                         <span class="dt">extremevalues =</span> <span class="st">"empirical"</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>                         <span class="dt">ev.perc =</span> <span class="fl">.10</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(test<span class="op">$</span>Data)</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt;            X    Y OriginalOrder isEV YDeviates</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; 1:  7.313777 10.4            15  Yes 3.0862233</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; 2: 10.148901 10.4            16  Yes 0.2510990</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; 3: 11.680210 13.3            24  Yes 1.6197895</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; 4: 12.795066 14.3             7  Yes 1.5049335</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; 5: 13.698771 14.7            17   No 1.0012292</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; 6: 14.474288 15.0            31   No 0.5257124</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(test<span class="op">$</span>Data<span class="op">$</span>isEV)</span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt; </span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt;  No Yes </span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt;  24   8</span></span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(test)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Many distributions beyond normal are possible. These can be compared visually or based on log likelihoods. Here we compare results between a normal and gamma distribution. The log likelihood values show that the <code>mpg</code> variable is better fit by the gamma distribution than the normal, although they are quite close.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>testN &lt;-<span class="st"> </span><span class="kw"><a href="../reference/testDistribution.html">testDistribution</a></span>(mtcars<span class="op">$</span>mpg, <span class="st">"normal"</span>,</span>
<span id="cb6-2"><a href="#cb6-2"></a>                          <span class="dt">extremevalues =</span> <span class="st">"theoretical"</span>,</span>
<span id="cb6-3"><a href="#cb6-3"></a>                          <span class="dt">ev.perc =</span> <span class="fl">.05</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>testG &lt;-<span class="st"> </span><span class="kw"><a href="../reference/testDistribution.html">testDistribution</a></span>(mtcars<span class="op">$</span>mpg, <span class="st">"gamma"</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>                          <span class="dt">extremevalues =</span> <span class="st">"theoretical"</span>,</span>
<span id="cb6-6"><a href="#cb6-6"></a>                          <span class="dt">ev.perc =</span> <span class="fl">.05</span>)</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">## compare the log likelihood assuming a normal or gamma distribution</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>testN<span class="op">$</span>Distribution<span class="op">$</span>LL</span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; 'log Lik.' -102.3778 (df=2)</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>testG<span class="op">$</span>Distribution<span class="op">$</span>LL</span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; 'log Lik.' -100.9208 (df=2)</span></span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(testN)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(testG)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
</div>
<div id="model-diagnostics" class="section level1">
<h1 class="hasAnchor">
<a href="#model-diagnostics" class="anchor"></a>Model Diagnostics</h1>
<p><code>JWileymisc</code> has features to support standard parametric model diagnostics. The generic function <code><a href="../reference/modelDiagnostics.html">modelDiagnostics()</a></code> has a method implemented for linear models.</p>
<p>In the code that follows, we use the <code><a href="../reference/modelDiagnostics.html">modelDiagnostics()</a></code> function to calculate some diagnostics which are plotted using the matching <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> method. The result is a plot of the standardized residuals against the expected (normal) distribution, the same QQ deviates plot we saw with <code><a href="../reference/testDistribution.html">testDistribution()</a></code>. Together, these provide information about whether the model assumption of normality is likely met, or not. In addition, block dots and the black rug lines indicate relatively extreme residual values. The label in the top left is the outcome variable name.</p>
<p>Another plot is a scatter plot of predicted values (x axis) against the standardized residuals (y axis). Again a five number summary is used for the x and y axis. To assess whether there are any systematic trends in the residuals, a loess line is added as a solid blue line. To assess heterogeneity/heteroscedasticity of residuals, quantile regression lines are added as dashed blue lines. These lines are for the 10th and 90th percentile of the distribution. Depending on the model and data, these quantile regression lines may use smoothing splines to allow non-linear patterns. For the assumption that residual variance is homogenous, you would expect the two lines to be approximately parallel and flat, with equal distance between them, across the range of predicted values.</p>
<p><strong>Note</strong> it is uncommon to decide that 5 percent of values are extreme. This high value was chosen to illustrate only. More common values in practice are <code>ev.perc = .001</code>, <code>ev.perc = .005</code> or <code>ev.perc = .01</code>, which capture 0.1%, 0.5%, and 1% of values, respectively. However, in this small dataset, those would not give many “extreme values” for illustration, so a higher value was used.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a></span>
<span id="cb8-2"><a href="#cb8-2"></a>m &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(mpg <span class="op">~</span><span class="st"> </span>hp <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(cyl), <span class="dt">data =</span> mtcars)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>md &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modelDiagnostics.html">modelDiagnostics</a></span>(m, <span class="dt">ev.perc =</span> <span class="fl">.05</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; Warning in .local(x, ...): singularity problem</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; Warning in rq.fit.sfn(x, y, tau = tau, rhs = rhs, control = control, ...): tiny diagonals replaced with Inf when calling blkfct</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; Warning in .local(x, ...): singularity problem</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; Warning in rq.fit.sfn(x, y, tau = tau, rhs = rhs, control = control, ...): tiny diagonals replaced with Inf when calling blkfct</span></span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(md, <span class="dt">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Finally, given that there are a few extreme values, we may want to identify and exclude them. We can view the extreme values. Here we extract these by effect type and with the outcome score associated with each. The index shows the index, from the residuals where the extreme values occurred. Note that this may not match up to the original data if there are missing values. In those cases, the easiest approach is to remove missing values on model variables first, then fit the model and then calculate diagnostics.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">## show extreme values</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>md<span class="op">$</span>extremeValues</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt;     mpg Index EffectType</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt; 1: 24.4     8  Residuals</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt; 2: 10.4    15  Residuals</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; 3: 33.9    20  Residuals</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; 4: 30.4    28  Residuals</span></span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">## show extreme values in overall dataset</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>mtcars[md<span class="op">$</span>extremeValues<span class="op">$</span>Index, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt;                     mpg cyl  disp  hp</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt; Merc 240D          24.4   4 146.7  62</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt; Cadillac Fleetwood 10.4   8 472.0 205</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt; Toyota Corolla     33.9   4  71.1  65</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt; Lotus Europa       30.4   4  95.1 113</span></span></code></pre></div>
<p>Using the extreme values index, we can exclude these and re-fit the model to see if it changes. We can show a summary of coefficients from each model and how much they change.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co">## exclude extreme values</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>m2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(mpg <span class="op">~</span><span class="st"> </span>hp <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(cyl), <span class="dt">data =</span> mtcars[<span class="op">-</span>md<span class="op">$</span>extremeValues<span class="op">$</span>Index, ])</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">## show a summary of coefficients from both models</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">## and the percent change</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="dt">M1 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(m),</span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="dt">M2 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(m2),</span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="dt">PercentChange =</span> <span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(m2) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(m) <span class="op">*</span><span class="st"> </span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span><span class="dv">100</span>), <span class="dv">2</span>)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="30%">
<col width="12%">
<col width="12%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left"> </th>
<th align="left">M1</th>
<th align="left">M2</th>
<th align="left">PercentChange</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>(Intercept)</strong></td>
<td align="left">35.98</td>
<td align="left">41.53</td>
<td align="left">15.42</td>
</tr>
<tr class="even">
<td align="left"><strong>hp</strong></td>
<td align="left">-0.11</td>
<td align="left">-0.19</td>
<td align="left">69.18</td>
</tr>
<tr class="odd">
<td align="left"><strong>factor(cyl)6</strong></td>
<td align="left">-15.31</td>
<td align="left">-20.86</td>
<td align="left">36.23</td>
</tr>
<tr class="even">
<td align="left"><strong>factor(cyl)8</strong></td>
<td align="left">-17.9</td>
<td align="left">-22.95</td>
<td align="left">28.19</td>
</tr>
<tr class="odd">
<td align="left"><strong>hp:factor(cyl)6</strong></td>
<td align="left">0.11</td>
<td align="left">0.18</td>
<td align="left">74.19</td>
</tr>
<tr class="even">
<td align="left"><strong>hp:factor(cyl)8</strong></td>
<td align="left">0.1</td>
<td align="left">0.18</td>
<td align="left">78.53</td>
</tr>
</tbody>
</table>
<p>Once some values are removed, new values may be extreme. Although additional passes are not that common, they can be done. In the following code, we conduct new diagnostics on the model that had extreme values from the first model removed.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">## diagnostics after removing outliers from first model</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>md2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modelDiagnostics.html">modelDiagnostics</a></span>(m2, <span class="dt">ev.perc =</span> <span class="fl">.05</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt; Warning in .local(x, ...): singularity problem</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; Warning in rq.fit.sfn(x, y, tau = tau, rhs = rhs, control = control, ...): tiny diagonals replaced with Inf when calling blkfct</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; Warning in .local(x, ...): singularity problem</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; Warning in rq.fit.sfn(x, y, tau = tau, rhs = rhs, control = control, ...): tiny diagonals replaced with Inf when calling blkfct</span></span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(md2, <span class="dt">ask =</span> <span class="ot">FALSE</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">## show (new) extreme values</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>md2<span class="op">$</span>extremeValues</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt;     mpg Index EffectType</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt; 1: 10.4    14  Residuals</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">#&gt; 2: 32.4    16  Residuals</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt; 3: 19.2    22  Residuals</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#univariate-diagnostics">Univariate Diagnostics</a></li>
      <li><a href="#model-diagnostics">Model Diagnostics</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua F. Wiley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
