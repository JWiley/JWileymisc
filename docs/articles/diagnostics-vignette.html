<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diagnostics • JWileymisc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Diagnostics">
<meta property="og:description" content="JWileymisc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">JWileymisc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/diagnostics-vignette.html">Diagnostics</a>
    </li>
    <li>
      <a href="../articles/exploratory-vignette.html">Exploratory and Descriptive Statistics and Plots</a>
    </li>
    <li>
      <a href="../articles/model-test-vignette.html">Model Performance and Tests</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JWiley/JWileymisc/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="diagnostics-vignette_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Diagnostics</h1>
                        <h4 class="author">Joshua F. Wiley</h4>
            
            <h4 class="date">2021-10-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JWiley/JWileymisc/blob/master/vignettes/diagnostics-vignette.Rmd"><code>vignettes/diagnostics-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>diagnostics-vignette.Rmd</code></div>

    </div>

    
    
<p>To start, load the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://joshuawiley.com/JWileymisc/">JWileymisc</a></span><span class="op">)</span></code></pre></div>
<div id="univariate-diagnostics" class="section level1">
<h1 class="hasAnchor">
<a href="#univariate-diagnostics" class="anchor"></a>Univariate Diagnostics</h1>
<p>The <code><a href="../reference/testDistribution.html">testDistribution()</a></code> function can be used to evaluate whether a variable comes from a specific, known parametric distribution. By default, no outliers or “extreme values” are shown. These can be used directly through the data output or plotted. The plot includes both the empirical density, the density of the assumed parametric distribution, a rug plot showing actual values, if not too many data points, and a Quantile-Quantile plot (QQ Plot). The QQ Plot is rotated to save space, by removing the diagonal and rotating to be horizontal, which we call a QQ Deviates plot.</p>
<p>One other unique feature of the density plot is the x axis. It follows Tufte’s principles about presenting data. To make the x axis more informative, it is a “range frame”, meaning it is only plotted over the range of the actual data. Secondly, the breaks are a five number summary of the data. These five numbers are:</p>
<ul>
<li>Minimum (0th percentile)</li>
<li>Lower quartile (25th percentile)</li>
<li>Median (50th percentile)</li>
<li>Upper quartile (75th percentile)</li>
<li>Maximum (100th percentile)</li>
</ul>
<p>Most plots use breaks that are evenly spaced. These do not convey information about the data. Using a five number summary the breaks themselves are effectively like a boxplot with specific values provided so you can immediately read what values the min and max are, the median, etc.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/testDistribution.html">testDistribution</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="st">"normal"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>
<span class="co">#&gt;            X    Y OriginalOrder isEV YDeviates</span>
<span class="co">#&gt; 1:  7.313777 10.4            15   No 3.0862233</span>
<span class="co">#&gt; 2: 10.148901 10.4            16   No 0.2510990</span>
<span class="co">#&gt; 3: 11.680210 13.3            24   No 1.6197895</span>
<span class="co">#&gt; 4: 12.795066 14.3             7   No 1.5049335</span>
<span class="co">#&gt; 5: 13.698771 14.7            17   No 1.0012292</span>
<span class="co">#&gt; 6: 14.474288 15.0            31   No 0.5257124</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Data</span><span class="op">$</span><span class="va">isEV</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  No Yes </span>
<span class="co">#&gt;  32   0</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>It is possible to have extreme values automatically identified either based on a theoretical distribution or empirically identified (e.g., the top or bottom XX percent are classified as extreme). We say that .10 (10%) of data points are “extreme” just to illustrate. Extreme values are shown in black with non extreme values shown in light grey, both in the rug plot and in the QQ plot. Although 10% is higher than typically would be chosen, given the small dataset, it is necessary to have extreme values at both ends of the distribution for illustration.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/testDistribution.html">testDistribution</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="st">"normal"</span>,
                         extremevalues <span class="op">=</span> <span class="st">"theoretical"</span>,
                         ev.perc <span class="op">=</span> <span class="fl">.10</span><span class="op">)</span>
<span class="co">## view the data with extreme values</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>
<span class="co">#&gt;            X    Y OriginalOrder isEV YDeviates</span>
<span class="co">#&gt; 1:  7.313777 10.4            15  Yes 3.0862233</span>
<span class="co">#&gt; 2: 10.148901 10.4            16  Yes 0.2510990</span>
<span class="co">#&gt; 3: 11.680210 13.3            24   No 1.6197895</span>
<span class="co">#&gt; 4: 12.795066 14.3             7   No 1.5049335</span>
<span class="co">#&gt; 5: 13.698771 14.7            17   No 1.0012292</span>
<span class="co">#&gt; 6: 14.474288 15.0            31   No 0.5257124</span>

<span class="co">## count how many extreme values there are</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Data</span><span class="op">$</span><span class="va">isEV</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  No Yes </span>
<span class="co">#&gt;  26   6</span>

<span class="co">## plot the distribution</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="co">## show which values are extreme</span>
<span class="va">test</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">isEV</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">]</span>
<span class="co">#&gt;            X    Y OriginalOrder isEV YDeviates</span>
<span class="co">#&gt; 1:  7.313777 10.4            15  Yes  3.086223</span>
<span class="co">#&gt; 2: 10.148901 10.4            16  Yes  0.251099</span>
<span class="co">#&gt; 3: 27.386184 30.4            19  Yes  3.013816</span>
<span class="co">#&gt; 4: 28.501040 30.4            28  Yes  1.898960</span>
<span class="co">#&gt; 5: 30.032349 32.4            18  Yes  2.367651</span>
<span class="co">#&gt; 6: 32.867473 33.9            20  Yes  1.032527</span>

<span class="co">## view extreme values on mpg in the original dataset</span>
<span class="co">## by use the original order, the original rows to select</span>
<span class="co">## the correct rows from the original dataset</span>
<span class="va">mtcars</span><span class="op">[</span><span class="va">test</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">isEV</span> <span class="op">==</span> <span class="st">"Yes"</span>, <span class="va">OriginalOrder</span><span class="op">]</span>, <span class="op">]</span>
<span class="co">#&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4</span>
<span class="co">#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="co">#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2</span>
<span class="co">#&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span>
<span class="co">#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span>
<span class="co">#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1</span></code></pre></div>
<p>Extreme values taken off the empirical percentiles can be chosen as well.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/testDistribution.html">testDistribution</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="st">"normal"</span>,
                         extremevalues <span class="op">=</span> <span class="st">"empirical"</span>,
                         ev.perc <span class="op">=</span> <span class="fl">.10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>
<span class="co">#&gt;            X    Y OriginalOrder isEV YDeviates</span>
<span class="co">#&gt; 1:  7.313777 10.4            15  Yes 3.0862233</span>
<span class="co">#&gt; 2: 10.148901 10.4            16  Yes 0.2510990</span>
<span class="co">#&gt; 3: 11.680210 13.3            24  Yes 1.6197895</span>
<span class="co">#&gt; 4: 12.795066 14.3             7  Yes 1.5049335</span>
<span class="co">#&gt; 5: 13.698771 14.7            17   No 1.0012292</span>
<span class="co">#&gt; 6: 14.474288 15.0            31   No 0.5257124</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Data</span><span class="op">$</span><span class="va">isEV</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  No Yes </span>
<span class="co">#&gt;  24   8</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Many distributions beyond normal are possible. These can be compared visually or based on log likelihoods. Here we compare results between a normal and gamma distribution. The log likelihood values show that the <code>mpg</code> variable is better fit by the gamma distribution than the normal, although they are quite close.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">testN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/testDistribution.html">testDistribution</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="st">"normal"</span>,
                          extremevalues <span class="op">=</span> <span class="st">"theoretical"</span>,
                          ev.perc <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>
<span class="va">testG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/testDistribution.html">testDistribution</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="st">"gamma"</span>,
                          extremevalues <span class="op">=</span> <span class="st">"theoretical"</span>,
                          ev.perc <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>

<span class="co">## compare the log likelihood assuming a normal or gamma distribution</span>
<span class="va">testN</span><span class="op">$</span><span class="va">Distribution</span><span class="op">$</span><span class="va">LL</span>
<span class="co">#&gt; 'log Lik.' -102.3778 (df=2)</span>
<span class="va">testG</span><span class="op">$</span><span class="va">Distribution</span><span class="op">$</span><span class="va">LL</span>
<span class="co">#&gt; 'log Lik.' -100.9208 (df=2)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">testN</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">testG</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
</div>
<div id="model-diagnostics" class="section level1">
<h1 class="hasAnchor">
<a href="#model-diagnostics" class="anchor"></a>Model Diagnostics</h1>
<p><code>JWileymisc</code> has features to support standard parametric model diagnostics. The generic function <code><a href="../reference/modelDiagnostics.html">modelDiagnostics()</a></code> has a method implemented for linear models.</p>
<p>In the code that follows, we use the <code><a href="../reference/modelDiagnostics.html">modelDiagnostics()</a></code> function to calculate some diagnostics which are plotted using the matching <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method. The result is a plot of the standardized residuals against the expected (normal) distribution, the same QQ deviates plot we saw with <code><a href="../reference/testDistribution.html">testDistribution()</a></code>. Together, these provide information about whether the model assumption of normality is likely met, or not. In addition, block dots and the black rug lines indicate relatively extreme residual values. The label in the top left is the outcome variable name.</p>
<p>Another plot is a scatter plot of predicted values (x axis) against the standardized residuals (y axis). Again a five number summary is used for the x and y axis. To assess whether there are any systematic trends in the residuals, a loess line is added as a solid blue line. To assess heterogeneity/heteroscedasticity of residuals, quantile regression lines are added as dashed blue lines. These lines are for the 10th and 90th percentile of the distribution. Depending on the model and data, these quantile regression lines may use smoothing splines to allow non-linear patterns. For the assumption that residual variance is homogenous, you would expect the two lines to be approximately parallel and flat, with equal distance between them, across the range of predicted values.</p>
<p><strong>Note</strong> it is uncommon to decide that 5 percent of values are extreme. This high value was chosen to illustrate only. More common values in practice are <code>ev.perc = .001</code>, <code>ev.perc = .005</code> or <code>ev.perc = .01</code>, which capture 0.1%, 0.5%, and 1% of values, respectively. However, in this small dataset, those would not give many “extreme values” for illustration, so a higher value was used.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span>

<span class="va">md</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelDiagnostics.html">modelDiagnostics</a></span><span class="op">(</span><span class="va">m</span>, ev.perc <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>
<span class="co">#&gt; Warning in .local(x, ...): singularity problem</span>
<span class="co">#&gt; Warning in rq.fit.sfn(x, y, tau = tau, rhs = rhs, control = control, ...): tiny diagonals replaced with Inf when calling blkfct</span>
<span class="co">#&gt; Warning in .local(x, ...): singularity problem</span>
<span class="co">#&gt; Warning in rq.fit.sfn(x, y, tau = tau, rhs = rhs, control = control, ...): tiny diagonals replaced with Inf when calling blkfct</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">md</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Finally, given that there are a few extreme values, we may want to identify and exclude them. We can view the extreme values. Here we extract these by effect type and with the outcome score associated with each. The index shows the index, from the residuals where the extreme values occurred. Note that this may not match up to the original data if there are missing values. In those cases, the easiest approach is to remove missing values on model variables first, then fit the model and then calculate diagnostics.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## show extreme values</span>
<span class="va">md</span><span class="op">$</span><span class="va">extremeValues</span>
<span class="co">#&gt;     mpg Index EffectType</span>
<span class="co">#&gt; 1: 24.4     8  Residuals</span>
<span class="co">#&gt; 2: 10.4    15  Residuals</span>
<span class="co">#&gt; 3: 33.9    20  Residuals</span>
<span class="co">#&gt; 4: 30.4    28  Residuals</span>

<span class="co">## show extreme values in overall dataset</span>
<span class="va">mtcars</span><span class="op">[</span><span class="va">md</span><span class="op">$</span><span class="va">extremeValues</span><span class="op">$</span><span class="va">Index</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="co">#&gt;                     mpg cyl  disp  hp</span>
<span class="co">#&gt; Merc 240D          24.4   4 146.7  62</span>
<span class="co">#&gt; Cadillac Fleetwood 10.4   8 472.0 205</span>
<span class="co">#&gt; Toyota Corolla     33.9   4  71.1  65</span>
<span class="co">#&gt; Lotus Europa       30.4   4  95.1 113</span></code></pre></div>
<p>Using the extreme values index, we can exclude these and re-fit the model to see if it changes. We can show a summary of coefficients from each model and how much they change.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## exclude extreme values</span>
<span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">md</span><span class="op">$</span><span class="va">extremeValues</span><span class="op">$</span><span class="va">Index</span>, <span class="op">]</span><span class="op">)</span>

<span class="co">## show a summary of coefficients from both models</span>
<span class="co">## and the percent change</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  M1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>,
  M2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>,
  PercentChange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">-</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="30%">
<col width="12%">
<col width="12%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left"> </th>
<th align="left">M1</th>
<th align="left">M2</th>
<th align="left">PercentChange</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>(Intercept)</strong></td>
<td align="left">35.98</td>
<td align="left">41.53</td>
<td align="left">15.42</td>
</tr>
<tr class="even">
<td align="left"><strong>hp</strong></td>
<td align="left">-0.11</td>
<td align="left">-0.19</td>
<td align="left">69.18</td>
</tr>
<tr class="odd">
<td align="left"><strong>factor(cyl)6</strong></td>
<td align="left">-15.31</td>
<td align="left">-20.86</td>
<td align="left">36.23</td>
</tr>
<tr class="even">
<td align="left"><strong>factor(cyl)8</strong></td>
<td align="left">-17.9</td>
<td align="left">-22.95</td>
<td align="left">28.19</td>
</tr>
<tr class="odd">
<td align="left"><strong>hp:factor(cyl)6</strong></td>
<td align="left">0.11</td>
<td align="left">0.18</td>
<td align="left">74.19</td>
</tr>
<tr class="even">
<td align="left"><strong>hp:factor(cyl)8</strong></td>
<td align="left">0.1</td>
<td align="left">0.18</td>
<td align="left">78.53</td>
</tr>
</tbody>
</table>
<p>Once some values are removed, new values may be extreme. Although additional passes are not that common, they can be done. In the following code, we conduct new diagnostics on the model that had extreme values from the first model removed.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## diagnostics after removing outliers from first model</span>
<span class="va">md2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelDiagnostics.html">modelDiagnostics</a></span><span class="op">(</span><span class="va">m2</span>, ev.perc <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>
<span class="co">#&gt; Warning in .local(x, ...): singularity problem</span>
<span class="co">#&gt; Warning in rq.fit.sfn(x, y, tau = tau, rhs = rhs, control = control, ...): tiny diagonals replaced with Inf when calling blkfct</span>
<span class="co">#&gt; Warning in .local(x, ...): singularity problem</span>
<span class="co">#&gt; Warning in rq.fit.sfn(x, y, tau = tau, rhs = rhs, control = control, ...): tiny diagonals replaced with Inf when calling blkfct</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">md2</span>, ask <span class="op">=</span> <span class="cn">FALSE</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostics-vignette_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## show (new) extreme values</span>
<span class="va">md2</span><span class="op">$</span><span class="va">extremeValues</span>
<span class="co">#&gt;     mpg Index EffectType</span>
<span class="co">#&gt; 1: 10.4    14  Residuals</span>
<span class="co">#&gt; 2: 32.4    16  Residuals</span>
<span class="co">#&gt; 3: 19.2    22  Residuals</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua F. Wiley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
